# 개발자용 상세 TODO 리스트 (구현 순서)

> 이 문서는 '학생 성적 관리 시스템'의 실제 개발을 위한 상세 작업 목록입니다. 각 TODO 항목은 개발 우선순위와 의존성을 고려하여 정렬되었습니다.

---

### 🏗️ TODO 0) Repo / 환경 (기본 골격)
- **monorepo 생성**: `/backend`, `/frontend`, `/infra` 폴더 구조 확립
- **backend 설정**:
  - `uv` 또는 `poetry`를 사용하여 Python 프로젝트 초기화
  - `FastAPI` 기본 애플리케이션 생성 및 실행 확인
- **Database 설정**:
  - `docker-compose`를 사용하여 PostgreSQL 컨테이너 추가
  - `.env` 파일을 통해 DB 연결 정보 등 환경변수 관리
- **DB 마이그레이션 설정**:
  - `Alembic` 세팅 완료 (`alembic init`)
  - DB 스키마 변경을 추적할 수 있는 상태로 준비
- **코드 스타일 및 정적 분석 설정**:
  - `ruff`와 `black`을 이용한 린트/포맷 규칙 적용
  - `pre-commit` 훅 설정으로 커밋 시 코드 스타일 자동 검사/수정
- **CI (지속적 통합) 설정**:
  - `GitHub Actions` 워크플로우 생성
  - 새로운 커밋/PR 발생 시 `backend` 코드에 대한 테스트 및 린트 자동 실행

---

### 📝 TODO 1) 요구사항/정책 파일 고정 (문서화)
- `docs/grading_policy.md` 문서 작성:
  - 절대평가 기준표 (예: A+ ≥ 95, A0 ≥ 90...)
  - 결시 및 미제출 처리 정책 (0점 처리, 감점 등)
  - 최종 점수 반올림 규칙
  - 동점자 처리 규칙
- `docs/rbac_matrix.md` 문서 작성:
  - 사용자 역할(Admin, Teacher, TA, Student)별 접근 가능한 기능 목록을 표로 정리
- `docs/report_formats.md` 문서 작성:
  - Excel/PDF 출력물에 포함될 항목 명시
  - 개인정보 보호를 위한 마스킹 규칙 (예: 학번 뒷자리, 이름 일부)
  - 생성될 파일의 이름 규칙 (예: `[과목명]_[날짜]_성적표.pdf`)
- **핵심 정책 명문화**:
  - "성적 확정(Lock) 이후에는 수정이 불가능하며, 정정이 필요할 경우 반드시 새로운 버전을 생성하여 이력을 남긴다"는 원칙을 명확히 기록

---

### 💾 TODO 2) DB/ERD 구현 (핵심 테이블 + 제약 + 인덱스)
- **Alembic 마이그레이션 생성**:
  - 아래 테이블 및 제약조건을 포함하는 마이그레이션 스크립트 작성
- **테이블 생성**:
  - `users`, `students`
  - `terms`, `classes`, `courses`, `enrollments`
  - `grade_components`, `scores`, `grade_results`
  - `grade_lock_versions`, `audit_logs`
- **제약조건 추가**:
  - `UNIQUE` on `students(student_no)`
  - `UNIQUE` on `enrollments(course_id, student_id)`
  - `UNIQUE` on `scores(component_id, student_id)`
- **인덱스 추가**:
  - `scores` 테이블 (course_id 기반 조회를 최적화하기 위해 component_id + student_id 조합 고려)
  - `grade_results` 테이블 (`course_id`, `student_id` 에 인덱스)
- **초기 데이터(seed) 스크립트**:
  - 시스템 운영을 위한 기본 관리자 계정 1개 생성

---

### 🔐 TODO 3) 인증/권한(RBAC)
- **Auth 구현**:
  - `JWT` access token과 refresh token 발급 및 검증 로직 구현
  - `Argon2` 또는 `bcrypt`를 사용한 비밀번호 해시 처리
- **RBAC 미들웨어/Dependency 구현**:
  - API 요청 시 토큰을 검증하고, 해당 사용자의 역할을 확인하는 의존성 주입
  - **리소스 소유권 체크 로직** 구현:
    - 학생(Student)은 본인의 성적 결과만 조회 가능
    - 조교/강사(Teacher/TA)는 본인이 담당하는 과목(Course) 범위 내의 데이터만 접근 가능
- **에러 규약 통일**:
  - 인증 실패 시 `401 Unauthorized`
  - 권한 부족 시 `403 Forbidden`
  - 데이터 충돌(예: 확정 후 수정 시도) 시 `409 Conflict` 등 에러 응답 표준화

---

### 🌐 TODO 4) 도메인 API (학기/반/과목/학생/수강)
- `Term` CRUD API
- `Class` CRUD API (생성 시 소유자 Teacher 지정)
- `Course` CRUD API (담당 Teacher/TA 매핑 기능 포함)
- `Student` CRUD API
- `Enrollment` (수강) API:
  - 수강생 추가/삭제/목록 조회 (`add/remove/list`)
  - 학생 목록 조회 시 학번/이름 검색 필터 기능
- **OpenAPI 스펙 정리**:
  - 각 API에 대한 명세(요청/응답 형식 등)를 상세히 작성
  - Postman 등에서 테스트할 수 있도록 샘플 요청/응답 JSON 첨부

---

### 🧮 TODO 5) 평가항목/점수/산출 엔진 (성적처리 핵심)
- **GradeComponent (평가 항목) CRUD API**:
  - `name`, `weight`, `max_score`, `rule_json` 필드 관리
- **Score (점수) 입력 API**:
  - 단건 입력 API (`PUT /scores/{score_id}`)
  - 대량 입력 API (`PUT /scores/bulk`)
  - 입력값 검증 로직 (0 ~ max_score 범위, '결시'/'미제출' 등 상태 값 처리)
- **Compute (미리보기) API**:
  - **총점 계산**: 각 항목 점수를 만점으로 정규화 후 가중치 적용하여 합산
  - **라운딩 정책** 적용 (소수점 처리)
  - **등급 변환**: 절대평가 기준표에 따라 등급 부여
- **Lock (확정) API**:
  - `grade_lock_version` 테이블에 새로운 확정 버전 생성
  - `grade_results` 테이블에 현재 성적 상태를 스냅샷으로 저장
  - 확정된 성적/규칙 수정 시 `409 Conflict` 에러 반환
- **AuditLog (감사 로그) 기록**:
  - 점수 변경, 평가 규칙 변경, 성적 확정, 성적표 출력 등 모든 주요 이벤트 발생 시 로그 기록

---

### 📤 TODO 6) 업로드(Excel/CSV) + 에러 리포트
- **업로드 템플릿 파일 생성**:
  - 학생 일괄 등록용 템플릿
  - 수강생 일괄 등록용 템플릿
  - 점수 일괄 입력용 템플릿 (항목별 / 전체)
- **Import API 구현**:
  - `pandas` 또는 `openpyxl` 라이브러리를 이용한 파일 파싱
  - 학번을 기준으로 시스템의 학생 정보와 매칭, 실패한 행은 따로 수집
- **실패 리포트 생성 기능**:
  - 업로드 실패 시, "어떤 행이, 어떤 이유로" 실패했는지 정리된 Excel 파일을 사용자에게 다운로드 제공
- **부분 성공 정책 적용**:
  - 업로드 파일의 각 행을 개별적으로 처리하여, 성공한 데이터는 DB에 반영하고 실패한 데이터는 리포트로 반환

---

### 📄 TODO 7) 출력(Excel/PDF) + 통계
- **Excel Export API (반 전체)**:
  - 학생별 총점, 등급, 각 평가 항목의 원점수 등을 포함하는 Excel 파일 생성
- **PDF 개인 성적표 생성 API**:
  - `HTML` 템플릿을 기반으로 `weasyprint` 등의 라이브러리를 사용하여 PDF로 변환
  - 학교/학원 로고, 학기, 과목명, 항목별 점수, 총점, 최종 등급 포함
- **통계 API**:
  - 과목 전체 평균, 표준편차, 점수 구간별 인원 분포 등 계산
- **파일 관리 및 보안**:
  - 생성된 파일은 별도 테이블에서 관리
  - (선택) 다운로드 링크에 만료 시간이 있는 임시 토큰을 적용하여 보안 강화

---

### 🖥️ TODO 8) 프론트엔드(웹) MVP
- **인증 화면**:
  - 로그인 화면 구현
  - JWT 토큰 저장 및 자동 갱신 로직
- **Teacher 대시보드**:
  - 자신이 담당하는 과목 목록 표시
  - **과목 상세 페이지 (탭 구조)**:
    - **설정**: 평가항목(가중치, 만점 등) 관리
    - **학생**: 수강생 목록 관리
    - **점수**: 스프레드시트 형태의 점수표 UI (ag-grid 등 라이브러리 활용)
    - **산출**: 성적 산출 미리보기
    - **확정**: 성적 확정(lock) 버튼
    - **출력**: 성적표/명단 다운로드
- **Student 화면**:
  - 수강 과목 목록 및 과목별 본인 성적 조회
  - 개인 성적표 PDF 다운로드

---

### ✅ TODO 9) 테스트/품질 (분쟁 방지용)
- **유닛 테스트**:
  - 성적 계산 엔진에 대한 다양한 케이스 테스트 (최소 20개 이상, 예: 소수점, 결시, 동점 등)
- **통합 테스트**:
  - **핵심 시나리오**: `업로드 → 점수 입력 → 산출(compute) → 확정(lock) → 출력(export)` 전체 흐름 테스트
  - **권한 시나리오**: 학생 역할로 다른 학생 정보 접근 시 실패하는지 테스트
- **회귀 테스트**:
  - 고정된 샘플 데이터셋(seed)을 이용하여, 코드 변경 후에도 기존 기능이 정상 동작하는지 확인

---

### 🚀 TODO 10) 배포/운영
- **Production 환경용 Docker Compose 구성**:
  - `FastAPI` 서버, `Nginx` (리버스 프록시) 포함
- **HTTPS 적용**:
  - `Let's Encrypt` 등을 이용한 SSL/TLS 인증서 적용
- **로깅 및 모니터링**:
  - 구조화된 로그(JSON 형식 등) 적용하여 로그 검색 용이성 확보
  - (선택) `Sentry` 등 에러 추적 서비스 연동
- **백업 및 복구**:
  - DB 자동 백업 스크립트 작성 및 복구 절차 문서화
- **운영자 매뉴얼**:
  - 계정 생성/삭제, 권한 변경, 데이터 백업 등 운영에 필요한 절차를 문서로 정리

---

### ✨ (옵션) TODO 11) 고도화
- **정정요청 워크플로우**: 학생이 성적에 이의를 제기하고, 교수가 승인/반려하는 기능
- **상대평가 모드**: 설정된 비율에 따라 등급을 부여하는 로직 추가
- **모바일 앱**: `React Native` 등을 이용한 모바일 앱 개발
- **푸시 알림**: 성적 공개, 공지사항 등을 모바일/웹 푸시로 알림
